<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/Bootstrap%205/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/js/Bootstrap%205/bootstrap.bundle.min.js"></script>
    <script src="/js/JQuery/jquery-3.7.1.js"></script>
    <link href="/css/select2/select2.css" rel="stylesheet" />
    <script src="/js/select2/select2.min.js"></script>
    <link href="/css/DataTable/jquery.dataTables.css" rel="stylesheet">
    <script src="/js/DataTable/jquery.dataTables.js"></script>
    <link href="/css/user.css" rel="stylesheet" >
    <!--    <script src="/js/user.js"></script>-->
    <link rel="shortcut icon" type="image/png" href="img/FPT_logo.png"/>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <link rel="stylesheet" href="css/syllabus/createSyllabusOutline.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">

    <title>Document</title>
</head>
<body>
<header class="bg-main text-white px-5 py-1" >
    <div th:replace="~{common :: header}"></div>
</header>

<div class="d-flex flex-grow-1 flex-row">
    <!--    WARNING-->
    <div class="toast warning">
        <div class="container-1">
            <i class="fas fa-exclamation-circle"></i>
        </div>
        <div class="container-2">
            <div class="container-2Text">
                <p>Warning</p>
                <p>Please fill all fields.</p>
            </div>
            <div class="loadingWarning"></div>
        </div>
    </div>
    <!--WARNING-->

    <!--    SUCCESS-->
    <div class="toast success">
        <div class="container-1">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="container-2">
            <div class="container-2Text">
                <p>Success</p>
                <p>Import successfully.</p>
            </div>
            <div class="loadingSucces"></div>
        </div>
    </div>
    <!--    SUCCESS-->

    <!--    ERROR-->
    <div class="toast error">
        <div class="container-1">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="container-2">
            <div class="container-2Text">
                <p>Error</p>
                <p></p>
            </div>
            <div class="loading1"></div>
        </div>
    </div>
    <!--    ERROR-->
    <div th:replace="~{common :: menu}"></div>

    <div class="frame-1186">
        <div class="program-detail">
            <div class="program-header">
                <div class="frame-1191">
                    <div class="training-program">Syllabus</div>
                    <!-- props: {"phase":{"type":"VARIANT","defaultValue":"'general'","variantOptions":["General","Outline","Done","Other"]}} -->
                    <div class="progress-bar">
                        <div class="label">
                            <div class="bar">
                                <div class="progress-bar2"></div>
                            </div>
                            <div class="padding">
                                <div class="text">General</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar2">
                                <div class="progress-bar2">
                                    <div class="ellipse-offset-to-get-to-the-middle">
                                        <div class="ellipse"></div>
                                    </div>
                                </div>
                                <div class="spacer"></div>
                            </div>
                            <div class="padding">
                                <div class="text">Outline</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar2">
                                <div class="progress-bar1"></div>
                            </div>
                            <div class="padding">
                                <div class="text2">Other</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar3">
                                <div class="progress-bar1"></div>
                            </div>
                            <div class="padding">
                                <div class="text">Done</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="basic-info">
                <div class="syllabus-name-code">
                    <div class="req-text-box">
                        <div class="text3">Syllabus Name*</div>
                        <input type="text" id="syllabusNameInput" name="" value="" class="text-box" >
                    </div>
                    <div class="req-text-box">
                        <div class="text3">Code:</div>
                        <div class="npl">NPL</div>
<!--                        <input type="hidden" id="syllabusCode" name="" value="" class="text-box" >-->
                    </div>
                    <div class="req-text-box">
                        <div class="text3">Version:</div>
                        <div class="_1-0">1.0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="frame-1189">
            <div class="b-ody">
                <div class="syllabus-tab">
                    <div class="tab-3">
                        <div class="frame-51">
                            <div class="tab-2">Others</div>
                        </div>
                    </div>
                    <div class="tab-1">
                        <div class="frame-51">
                            <div class="general">General</div>
                        </div>
                    </div>
                    <div class="tab-22">
                        <div class="frame-51">
                            <div class="tab-2">Outline</div>
                        </div>
                    </div>
                </div>
                <div class="frame-1207">
                    <div class="frame-1192">
                        <div class="content">
                            <div class="daye-">
                                <div class="frame-1193"></div>
<!--                                <div class="frame-54"></div>-->
<!--                                <dialog id="menu-syllabus-function-dialog" class="p-0" style="border-radius: 20px; border: none; width: 1000px">-->

<!--                                </dialog>-->
<!--                                <div class="dialog-backdrop" id="dialog-backdrop"></div>-->

                                <div class="add-unit-button">
                                    <div class="add-day-button2">
                                        <svg
                                                class="add3"
                                                width="24"
                                                height="24"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <g clip-path="url(#clip0_1173_19892)">
                                                <path
                                                        d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z"
                                                        fill="#F1F1F1"
                                                />
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_1173_19892">
                                                    <rect width="24" height="24" fill="white" />
                                                </clipPath>
                                            </defs>
                                        </svg>

                                        <button class="add-unit">Add unit</button>
                                    </div>
                                </div>

                            </div>
                            <button class="add-day-button-2">
                                <div class="add-day-button3">
                                    <svg
                                            class="add3"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <g clip-path="url(#clip0_1173_19917)">
                                            <path
                                                    d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z"
                                                    fill="#F1F1F1"
                                            />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1173_19917">
                                                <rect width="24" height="24" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>

                                    <div class="add-day">Add day</div>
                                </div>
                            </button>
                            <div class="rectangle-2487"></div>
                        </div>
<!--                        <div class="rectangle-645"></div>-->
                    </div>
                </div>
            </div>
            <div class="frame-1190">
                <div class="time-allocation">
                    <div class="time-allocation2">Time allocation</div>
                </div>
                <div class="time-allocation3">
                    <div class="time-allocation2">Time allocation</div>
                </div>
                <div class="content2">
                    <canvas class="doughnut" id="doughnut">
<!--                        <div class="_01"></div>-->
<!--                        <div class="_02"></div>-->
<!--                        <div class="_03"></div>-->
<!--                        <div class="_04"></div>-->
                    </canvas>
                    <div class="info">
                        <div class="frame-1082">
                            <div class="bullet">
                                <div class="rectangle-644"></div>
                            </div>
                            <div class="assignment-lab">Assignment</div>
                            <div class="_54" id="assignment_pie"></div>
                        </div>
                        <div class="frame-109">
                            <div class="bullet">
                                <div class="rectangle-6442"></div>
                            </div>
                            <div class="concept-lecture5">Quiz</div>
                            <div class="_29" id="quiz_pie"></div>
                        </div>
                        <div class="frame-110">
                            <div class="bullet">
                                <div class="rectangle-6443"></div>
                            </div>
                            <div class="guide-review2">Final</div>
                            <div class="_9" id="final_test_pie"></div>
                        </div>
                        <div class="frame-1112">
                            <div class="bullet">
                                <div class="rectangle-6444"></div>
                            </div>
                            <div class="test-quiz">Final Theory</div>
                            <div class="_1" id="final_theory_pie"></div>
                        </div>
                        <div class="frame-112">
                            <div class="bullet">
                                <div class="rectangle-6445"></div>
                            </div>
                            <div class="exam">Final Practice</div>
                            <div class="_6" id="final_practice_pie"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="saving-button">
            <div class="frame-92">
                <div class="previous">Previous</div>
            </div>
            <div class="frame-1201">
                <div class="add-day-button4">
                    <div class="cancel">Cancel</div>
                </div>
                <div class="frame-91">
                    <div class="save">Save as draft</div>
                </div>
                <div class="frame-912">
                    <a th:href="@{/createSyllabusOtherScreen}" style="text-decoration: none; color: #eeecec">
                        <div class="next save-btn">
                            Next
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>


</div>

<div th:replace="~{common :: footer}"></div>

<script src="/js/common.js"></script>

<script>
// =========================================================================

    const topicCodedata = localStorage.getItem("topicCode");
    const savedSyllabusCode = localStorage.getItem("topicCode");
    var api2;
    var selectedDay;
    var unitCodedata;
    var status;
    var unitCode;
    // const topicCodedata = "A01";
    // const savedSyllabusCode = "A01";
    $(document).ready(function() {
        loadChart();

        // Load data when the page is refreshed

        console.log(savedSyllabusCode);
        if (savedSyllabusCode) {
            loadData(savedSyllabusCode);
        }

        // Event listener for adding a day
        $('.add-day-button-2').click(function() {
            location.reload();
            addDay();
        });
        $(document).on('click', '#toggleButton', function () {
            $('.toggle-online').toggleClass('active');
            if ($('.online-add').length) {
                status = 'Offline';
                // If the current status is online, replace with offline
                $('.online-add').replaceWith(function () {
                    return $('<div>').addClass('offline-add').val('OFFLINE').text('Offline').attr('id', 'toggle');
                });
                $('.offline-add').toggleClass('active');
            } else {
                status = 'Online';
                // If the current status is offline, replace with online
                $('.offline-add').replaceWith(function () {
                    return $('<div>').addClass('online-add').val('ONLINE').text('Online').attr('id', 'toggle');
                });
            }

        });
        $('.add-unit').click(function() {
            if (selectedDay != null) {
                addUnitCode();
                setTimeout(() => {
                    getTrainingUnitforadd();
                    console.log('Training unit retrieved.');
                }, 100);
            }
            else {
                showWarning("You have to select day before add TrainingUnit");
            }
        });
    });
    function updateUnitNames(data) {
        var unitNames = data.unitName;
        var unitCodes = data.unitCode;
        const lastestUnitCode = unitCodes[unitCodes.length - 1];
        unitCodedata = lastestUnitCode;
        const lastestUnit = unitNames.length;
        var day1 = selectedDay;
        if (unitNames[unitNames.length - 2] != "" || unitNames.length == 1) {
            var unitNameContainer = $('<div>',{
                class: 'unit-names-container',
                id: 'unit-names-container--' + day1
            });

            var unitContainer = $('<div>').addClass('frame-108');

            var unitLabel = $('<div>', {
                class: 'unit-7 u' + lastestUnit,
                text: 'Unit ' + lastestUnit // You may need to adjust the index accordingly
            });

            var programContainer = $('<div>').addClass('frame-1199');

            var programName = $('<div>').addClass('program-name');

            var unitNameElement = $('<div>', {
                class: 'unit-name',
                text:'Unit Name'
            });
            var frame84 = $('<div>').addClass('frame-84');

            var typeUnitName = $('<input>', {
                class: 'type-unit-name styled-input',
                type: 'text',
                id: 'unitNameInput',
                placeholder: 'Type unit name',
            });

            // var transferunitCode = $('<input>', {
            //     type: 'hidden',
            //     class: 'unitCodee',
            //     value: lastestUnitCode
            // });

            var frame66 = $('<div>').addClass('frame-66');

            var create = $('<button>', {
                class: 'create',
                text: 'Create'
            });
            var unitNamefield = $('<div>').addClass('frame-54 uday--' + day1);
            // Assemble the structure
            frame66.append(create);
            frame84.append(typeUnitName);
            // frame84.append(transferunitCode);
            frame84.append(frame66);
            programName.append(unitNameElement);
            programName.append(frame84);
            programContainer.append(unitLabel);
            programContainer.append(programName);
            // unitContainer.append(unitLabel);
            unitContainer.append(programContainer);
            unitNameContainer.append(unitContainer);
            // unitNameContainer.append(programContainer);
            unitNamefield.append(unitNameContainer);

            // Ẩn tất cả các ngày trước
            if($('.uday--' + day1).length === 1){
                var link = $('.day-'+ day1);
                console.log(unitNamefield);
                link.append(unitNamefield);
                console.log("append dc");
            }
            typeUnitName.on('change', function () {
                var typedUnitName = $(this).val().toString().trim();
                create.click(function () {
                    if (typedUnitName != ""){
                        createUnitName(data,typedUnitName);
                            var day = selectedDay;
                            $('.frame-54').remove();
                            setTimeout(()=>{
                                updateSelectedDay(day);
                                // $('.unit-names-container').hide();
                                var unitNamefield = $('<div>').addClass('frame-54 uday--' + day);
                                if ($('.uday--' + day).length === 0) {
                                    var link = $('.day-' + day);
                                    console.log(unitNamefield);
                                    link.append(unitNamefield);
                                    console.log("append dc");
                                }},200)

                    }
                    else
                    {
                        showWarning("Invalid Unit Name ");
                    }

                });
            });
    }else {
            showError('Has not added Training Content yet ');
        }
    }
    //Create Unit Name
    function createUnitName(data, typedUnitName){
        var unitName = typedUnitName;
        var topicCode = topicCodedata;
        var dayNumber = selectedDay;
        var unitCodes1 = data.unitCode;
        const lastestUnitCode = unitCodes1[unitCodes1.length - 1];
        unitCodedata = lastestUnitCode;
        // Second AJAX request to load unit names for the selected day
        var apiUrl = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/createTrainingUnit/' + topicCode + '/' + dayNumber + '/' + lastestUnitCode;

        var accessToken = getCookie("accessToken");
        $.ajax({
            url: apiUrl,
            type: 'POST',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            contentType: 'application/json', // Set the content type if needed
            data: JSON.stringify({ unitName: unitName }), // Send the unitName as JSON data
            success: function (data) {
                // Handle the API response here
                console.log('API response:', data);
                showSuccess('Added TrainingContent successfully');
                // console.log(unitCode);
                // You can perform additional actions as needed
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    alert("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    // Define a function to load data based on the syllabus name
    function loadData(topicCode) {
        var apiUrl = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/syllabus/' + topicCode;

        var accessToken = getCookie("accessToken");
        // First AJAX request to load syllabus data

        $.ajax({
            url: apiUrl,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                console.log(data);
                // Handle the successful response and update the HTML elements
                loadSyllabus(data);
                loadday(data.topicCode)
                api2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/' + data.topicCode + '/';
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({refreshToken: refreshToken}), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken", accessTokenV2, 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    showError("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    function loadday(topicCode){
        var apiUrl = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/' + topicCode;
        var accessToken = getCookie("accessToken");
        $.ajax({
            url: apiUrl,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                console.log(data);
                // Handle the successful response and update the HTML elements
                updateSyllabusData(data);
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    alert("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    function getTrainingContent(unitCode1) {
        var day = selectedDay;
        var unitCode2 = unitCode1;
        var apiUrl2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/ShowTrainingContent/' + day + '/' + unitCode2;
        // Second AJAX request to load unit names for the selected day
        var accessToken = getCookie("accessToken");
        $.ajax({
            url: apiUrl2,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                console.log('Success:', data);
                updateTrainingContent(data);
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    alert("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    function addUnitCode(){
        var topicCode1 = topicCodedata;
        var dayNumber1 = selectedDay;
        var apiUrl1 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/addTrainingUnitCode/'+ topicCode1 + '/' + dayNumber1;

        $.ajax(
            {
                url : apiUrl1,
                type : 'POST',

                success: function(response) {
                    // Handle the successful response or any additional actions
                    console.log(response);
                    // Reload the page after a successful request
                },
                error: function(error) {
                    // Handle the error or any error-specific actions
                    console.log('Error:', error);
                }
            }
        )
    }
    function  addDay(){
        if (topicCodedata) {
            var syllabusCode = topicCodedata;
            var apiUrl2 = "http://localhost:8080/api/v1/syllabus/OutlineScreen/addDay/" + syllabusCode;
            var accessToken = getCookie("accessToken");
            $.ajax({
                url: apiUrl2,
                type: 'POST',
                headers: {
                    "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
                },
                xhrFields: {
                    withCredentials: true
                },
                success: function(response) {
                    // Handle the successful response or any additional actions
                    console.log(response);
                    loadday(syllabusCode);
                    // Reload the page after a successful request
                },
                error: function (error) {
                    // alert(error);
                    // Xử lý lỗi khi gửi yêu cầu
                    if (error.status === 401) {
                        // Trường hợp lỗi 401: Unauthorized
                        // Gửi yêu cầu refreshToken để lấy accessToken mới
                        var refreshToken = getCookie("refreshToken");
                        $.ajax({
                            url: "http://localhost:8080/api/v1/auth/refreshToken",
                            method: "POST",
                            data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                            contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                            xhrFields: {
                                withCredentials: true
                            },
                            success: function (response) {
                                //Xóa cookie cũ (accessToken)
                                deleteCookie("accessToken");
                                // Lưu accessToken mới vào cookie
                                var accessTokenV2 = response.payload.accessToken;

                                setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                                // // Xóa cookie cũ (refreshToken)
                                // deleteCookie("refreshToken");

                                // Gửi lại yêu cầu gốc với accessToken mới
                                sendSearchRequest(searchKeywords);
                            },
                            error: function (refreshError) {
                                if (refreshError.status === 403) {
                                    // Trường hợp lỗi 403: Forbidden
                                    // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                    // )
                                    window.location.href = "http://localhost:8081/logout" +
                                        "";
                                } else {
                                    alert("Refresh token failed: " + refreshError);
                                    // Xử lý lỗi khác khi refreshToken không thành công
                                    window.location.href = "http://localhost:8081/logout" +
                                        "";

                                }
                            }
                        });
                    } else {
                        alert("Error: " + error.status);
                        // Xử lý lỗi khác (không phải lỗi 401)
                        // window.location.href = "http://localhost:8081/logout
                        // ";
                    }
                }
            });
        }
    }
    // Cập nhật ngày được chọn và thực hiện AJAX request
    function updateSelectedDay(selectedDay) {
        // var updatedApi2 = api2 + selectedDay;
        var topicCode = topicCodedata;
        var day = selectedDay;
        var updatedApi2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/'+ topicCode + '/' + day;
        // Second AJAX request to load unit names for the selected day
        var accessToken = getCookie("accessToken");
        $.ajax({
            url: updatedApi2,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                // Handle the successful response and update the HTML elements
                loadTrainingUnit(data);
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    alert("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    // Get again the unitCode when add unit
    // Function to update the unit names
    function createClickableRemoveIcon() {
        var svgElement = $('<svg>', {
            class: 'remove-circle-outline',
            width: '24',
            height: '24',
            viewBox: '0 0 24 24',
            fill: 'none',
            'xmlns:xlink': 'http://www.w3.org/2000/svg',
        });

        var clipPathElement = $('<clipPath>', {
            id: 'clip0_1173_20029',
        }).append($('<rect>', {
            width: '24',
            height: '24',
            fill: 'white',
        }));

        var pathElement = $('<path>', {
            d: 'M7 11V13H17V11H7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z',
            fill: '#E74A3B',
        });

        svgElement.append(clipPathElement);
        svgElement.append(pathElement);

        // Add a click event listener to the icon
        svgElement.click(function() {
            // Handle the click event here
            // You can access information related to the clicked "Day" div
            // You can use $(this) to refer to the clicked icon
        });

        return svgElement;
    }
    function loadSyllabus(data){
        var topicName = data.topicName;
        var versiondata = data.version;

        var topicNamefield = $('#syllabusNameInput');
        var topicCodefield = $('.npl');
        var versionfield = $('._1-0');

        topicNamefield.val(topicName).prop('readonly',true);
        topicCodefield.text(topicCodedata);
        versionfield.text(versiondata);
    }
    function updateSyllabusData(data) {

        var days = data.dayNumber; // Assuming this is an array of days

        // Loại bỏ các giá trị ngày trùng lặp
        var uniqueDays = Array.from(new Set(days.flat()));

        // Sử dụng mảng không trùng lặp
        var addedDays = [];

        // Xóa tất cả nút "Day" cũ trước khi thêm nút mới
        var daymainField = $('.frame-1193');
        daymainField.empty();

        for (var i = 0; i < uniqueDays.length; i++) {
            var day = uniqueDays[i];

            // Kiểm tra xem ngày đã được thêm chưa
            if (!addedDays.includes(day)) {
                addedDays.push(day); // Thêm ngày vào mảng

                var dayfield = $('<button>').addClass('day num'+ day).text('Day ' + day);
                var clickableIcon = createClickableRemoveIcon(); // Create the clickable icon
                dayfield.append(clickableIcon);
                var dayContainer = $('<div>').addClass('day-container day-- day-'+ day);
                var addclass1 = $('<button>').addClass('frame-48');
                var addclass2 = $('<div>').addClass('frame-512');
                var addclass3 = $('<div>').addClass('frame-513');

                addclass3.append(dayfield);
                addclass2.append(addclass3);
                addclass1.append(addclass2);
                dayContainer.append(addclass1);
                daymainField.append(dayContainer);
                // Attach the click event to the newly created day buttons
                dayfield.click(function () {
                    $('.frame-54').remove();
                    selectedDay = $(this).text().replace('Day ', '');
                    updateSelectedDay(selectedDay);
                    $('.unit-names-container').hide();
                    day = selectedDay;
                    var unitNamefield = $('<div>').addClass('frame-54 uday--'+day);
                    // Ẩn tất cả các ngày trước
                    if($('.uday--' + day).length === 0){
                        var link = $('.day-'+ day);
                        console.log(unitNamefield);
                        link.append(unitNamefield);
                        console.log("append dc");
                    }
                });
            }
        }
    }
    function loadTrainingUnit(data) {
        var unitNames1 = data.unitName;
        var unitCodes1 = data.unitCode;
        unitCode = unitCodes1;
        var day = selectedDay;
        var unitNamefield = $('.uday--'+day);
        $('.unit-names-container').hide();
        console.log(unitNames1);
        if (unitNames1 != ""){
            $.each(unitNames1, function (index, unitName1) {
                var unitCode1 = unitCodes1[index]; // Get the corresponding unitCode
                if (unitName1 !='' ) {
                    var unitNameContainer = $('<div>', {
                        class: 'unit-names-container',
                        id: 'unit-names-container--' + day + '-' + unitCode1
                    });
                    var unitContainer = $('<div>').addClass('frame-108');
                    var unitLabel = $('<div>', {
                        class: 'unit-7',
                        text: 'Unit ' + (index + 1)
                    });

                    var programContainer = $('<div>').addClass('frame-1199');
                    var programName = $('<div>').addClass('program-name').attr('id','unitname-'+ day + '-' + unitCode1);
                    var unitNameElement = $('<div>', {
                        class: 'unit-7',
                        text: unitName1 // Display the unit name
                    });


                    // Assemble the structure
                    programName.append(unitNameElement);
                    programContainer.append(unitLabel);
                    programContainer.append(programName);
                    unitContainer.append(programContainer);
                    unitNameContainer.append(unitContainer);
                    unitNamefield.append(unitNameContainer);
                }
                getTrainingContent(unitCode1);
        });
            // getTrainingContent(unitCodes1);
            setTimeout(() => {
                // var addDiv = $('<button>').addClass('add');
                // unitNamefield.append(addDiv);
            },20);
        }
        else {
            showWarning("Continue to add Training Unit to show Day");
        }
    }
    function getTrainingUnitforadd() {
        var day = selectedDay;
        var topicCodene = topicCodedata;
        var apiUrl2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/ShowTrainingUnit/' + topicCodene + '/' + day;
        // Second AJAX request to load unit names for the selected day
        var accessToken = getCookie("accessToken");
        $.ajax({
            url: apiUrl2,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
            success: function (data) {
                console.log(data);
                updateUnitNames(data);
            },
            error: function (error) {
                // alert(error);
                // Xử lý lỗi khi gửi yêu cầu
                if (error.status === 401) {
                    // Trường hợp lỗi 401: Unauthorized
                    // Gửi yêu cầu refreshToken để lấy accessToken mới
                    var refreshToken = getCookie("refreshToken");
                    $.ajax({
                        url: "http://localhost:8080/api/v1/auth/refreshToken",
                        method: "POST",
                        data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                        contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                        xhrFields: {
                            withCredentials: true
                        },
                        success: function (response) {
                            //Xóa cookie cũ (accessToken)
                            deleteCookie("accessToken");
                            // Lưu accessToken mới vào cookie
                            var accessTokenV2 = response.payload.accessToken;

                            setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                            // // Xóa cookie cũ (refreshToken)
                            // deleteCookie("refreshToken");

                            // Gửi lại yêu cầu gốc với accessToken mới
                            sendSearchRequest(searchKeywords);
                        },
                        error: function (refreshError) {
                            if (refreshError.status === 403) {
                                // Trường hợp lỗi 403: Forbidden
                                // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                // )
                                window.location.href = "http://localhost:8081/logout" +
                                    "";
                            } else {
                                alert("Refresh token failed: " + refreshError);
                                // Xử lý lỗi khác khi refreshToken không thành công
                                window.location.href = "http://localhost:8081/logout" +
                                    "";

                            }
                        }
                    });
                } else {
                    alert("Error: " + error.status);
                    // Xử lý lỗi khác (không phải lỗi 401)
                    // window.location.href = "http://localhost:8081/logout
                    // ";
                }
            }
        });
    }
    function updateTrainingContent(data){
        var contents = data.content;
        var Id = data.trainingContentId;
        var duration = data.duration;
        var format= data.trainingFormat
        var day = selectedDay;
        var deliveryTypes = data.deliveryType;
        var unitNamefield = $('#unit-names-container--'+ day + '-' + data.unitCode1);
        var TrainingContent_Field = $('<div>').addClass('trainingContent-field')
        let totalDuration = 0;
        $.each(contents, function (index, contentItem) {
            var trainingContentContainer = $('<div>').addClass('frame-41');
            var trainingContentName = $('<div>', {
                class: 'operators',
                text: contentItem
            });
            // Use console.log for debugging
            console.log(contentItem);
            var trainingContentdetailContainer = $('<div>').addClass('frame-40');
            var trainingContentIdContainer = $('<div>').addClass('frame-95');
            var trainingContentId = $('<div>', {
                class: 'h-4-sd',
                text: Id[index]
            });
            var trainingContentDuration = $('<div>', {
                class: '_30-mins',
                text: duration[index]
            });
            // var trainingContentFormatContain = $('<div>').addClass('online');
            // var trainingContentFormat = $('<div>', {
            //     class: 'online2',
            //     text: format[index]
            // });
            var type = deliveryTypes[index];
            // var addfolder = $('<button>').addClass('folder-btn');
            trainingContentIdContainer.append(trainingContentId);
            // trainingContentFormatContain.append(trainingContentFormat);
            // trainingContentdetailContainer.append(trainingContentIdContainer, trainingContentDuration, trainingContentFormatContain);
            trainingContentdetailContainer.append(trainingContentIdContainer, trainingContentDuration, createdivTrainingFormat(format[index]));
            trainingContentContainer.append(trainingContentName, trainingContentdetailContainer,createIconfordeliverType(type));
            TrainingContent_Field.append(trainingContentContainer);
            unitNamefield.append(TrainingContent_Field);
            // Update total duration
            totalDuration += parseFloat(duration[index]);

        });

        var addDiv = $('<button>').addClass('add').attr('id','addbtn');
        unitNamefield.append(addDiv);
        if (totalDuration != 0) {
            if (totalDuration == 1) {
                var totalDuration1 = $('<div>').addClass('duration').text(totalDuration + 'hr');
            } else if (totalDuration > 1) {
                var totalDuration1 = $('<div>').addClass('duration').text(totalDuration + 'hrs');
            }
            var unitName = $('#unitname-'+ day + '-' + data.unitCode1);
            unitName.append(totalDuration1);
        }
        addDiv.click(function (){
            // event.preventDefault();
            $('.add').remove();
            getDeliveryAndType(data.unitCode1);
        });
    }
    function addTrainingContentform(deliveryData, typeData,trainingUnit,unitCode){
        if (trainingUnit.unitName.toString() != "") {
            var unitNamefield2 = $('.frame-42');
            if (unitNamefield2.length === 0){
                var day = selectedDay;
                var unitNamefield = $('#unit-names-container--'+ day + '-' + unitCode);
                var TrainingContent_Field = $('<div>').addClass('trainingContent-field')
                // Create main container
                var mainContainer = $('<div>').addClass('frame-42');

                // Create nested containers
                var frame1197 = $('<div>').addClass('frame-1197');
                var practiceTime = $('<input>').addClass('practice-time').attr('placeholder','Training Content Name').attr('id','Content-Name');
                frame1197.append(practiceTime);

                // var frame40 = $('<div>').addClass('frame-40');

                // Create delivery type container
                var deliveryType = $('<div>').addClass('delivery-type');
                var frame111 = $('<div>').addClass('frame-111');
                var deliveryType2 = $('<select>').addClass('delivery-type2').attr('id', 'leariningType');
                // Adding options to the select element
                typeData.forEach(function (contentType1) {
                    var option = $('<option>').val(contentType1).text(contentType1);
                    deliveryType2.append(option);
                });

    // Appending options to the select element
                var arrowBackIos = $('<svg>').addClass('arrow-back-ios')
                    .attr({
                        width: '24',
                        height: '24',
                        viewBox: '0 0 24 24',
                        fill: 'none',
                        xmlns: 'http://www.w3.org/2000/svg'
                    });
                var arrowBackIosPath = $('<path>').attr('d', 'M7.16212 8L6 9.0677L12.5 15L19 9.0617L17.8379 8L12.5 12.8766L7.16212 8Z').attr('fill', '#285D9A');
                arrowBackIos.append(arrowBackIosPath);
                frame111.append(deliveryType2, arrowBackIos);
                deliveryType.append(frame111);

    // Other elements in frame40
                var frame1198 = $('<div>').addClass('frame-1198');
                // var _15 = $('<div>').addClass('_15').text('15');
                var _15 = $('<input>').addClass('_15').attr('id','duration_add').attr('placeholder','duration').attr('type', 'number').attr('pattern', '[0-9]*');
                frame1198.append(_15);

                var toggleOnline = $('<div>').addClass('toggle-online');
                var ellipse19 = $('<div>').addClass('ellipse-19').attr('id','toggleButton');
                var online = $('<div>').addClass('online-add').text('Online').val('ONLINE').attr('id','toggle');
                toggleOnline.append(ellipse19, online);

                // Another delivery type container
                // Create delivery type container
                var deliveryType_2 = $('<div>').addClass('delivery-type');
                var frame111_2 = $('<div>').addClass('frame-111');
                var deliveryType2_2 = $('<select>').addClass('delivery-type2').attr('id', 'output-standard');
                // Adding options to the select element
                deliveryData.forEach(function (contentType) {
                    var option_2 = $('<option>').val(contentType).text(contentType);
                    deliveryType2_2.append(option_2);
                });

                // Appending options to the select element
                var arrowBackIos_2 = $('<svg>').addClass('arrow-back-ios')
                    .attr({
                        width: '24',
                        height: '24',
                        viewBox: '0 0 24 24',
                        fill: 'none',
                        xmlns: 'http://www.w3.org/2000/svg'
                    });
                var arrowBackIosPath_2 = $('<path>').attr('d', 'M7.16212 8L6 9.0677L12.5 15L19 9.0617L17.8379 8L12.5 12.8766L7.16212 8Z').attr('fill', '#285D9A');
                arrowBackIos_2.append(arrowBackIosPath_2);
                frame111_2.append(deliveryType2_2, arrowBackIos_2);
                deliveryType_2.append(frame111_2);
                var addfolder = $('<button>').addClass('folder-btn');

                // Append everything to the main container
                // frame40.append(deliveryType, frame1198, toggleOnline, deliveryType2, addfolder);
                mainContainer.append(frame1197, deliveryType, frame1198, toggleOnline, deliveryType_2, addfolder);
                // Append main container to the body or any other parent element
                TrainingContent_Field.append(mainContainer);
                unitNamefield.append(TrainingContent_Field);
                // var addDiv = $('<button>').addClass('add');
                // unitNamefield.append(addDiv);
                    addfolder.click(function (){
                        var contentName = $('#Content-Name').val();
                        var deliveryType = $('#output-standard').val();
                        var duration = $('#duration_add').val();
                        var type = $('#leariningType').val();
                        var trainingFormat = $('#toggle').val();
                        var day = selectedDay;
                        var topicCode = topicCodedata;
                        // Check if required fields are not empty
                        if (contentName.trim() !== "" && deliveryType.trim() !== "" && duration.trim() !== "") {
                            // Make AJAX call to the API
                            var accessToken = getCookie("accessToken");
                            $.ajax({
                                url: 'http://localhost:8080/api/v1/syllabus/OutlineScreen/createTrainingContent/'+topicCode+'/'+day+'/'+unitCode,
                                type: 'POST',
                                headers: {
                                    "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
                                },
                                xhrFields: {
                                    withCredentials: true
                                },
                                contentType: 'application/json',
                                data: JSON.stringify({
                                    content:contentName,
                                    duration: duration,
                                    trainingFormat:trainingFormat,
                                    deliveryType:deliveryType,
                                    type: type
                                    // Add other parameters if needed
                                }),
                                success: function () {
                                    showSuccess('Added TrainingContent successfully');
                                    $('.frame-54').remove();
                                    updateSelectedDay(day);
                                    $('.unit-names-container').hide();
                                    var unitNamefield = $('<div>').addClass('frame-54 uday--' + day);
                                    if($('.uday--' + day).length === 0){
                                        var link = $('.day-' + day);
                                        console.log(unitNamefield);
                                        link.append(unitNamefield);
                                        console.log("append dc");
                                    }
                                },
                                    error: function (error) {
                                        // alert(error);
                                        // Xử lý lỗi khi gửi yêu cầu
                                        if (error.status === 401) {
                                            // Trường hợp lỗi 401: Unauthorized
                                            // Gửi yêu cầu refreshToken để lấy accessToken mới
                                            var refreshToken = getCookie("refreshToken");
                                            $.ajax({
                                                url: "http://localhost:8080/api/v1/auth/refreshToken",
                                                method: "POST",
                                                data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                                                contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                                                xhrFields: {
                                                    withCredentials: true
                                                },
                                                success: function (response) {
                                                    //Xóa cookie cũ (accessToken)
                                                    deleteCookie("accessToken");
                                                    // Lưu accessToken mới vào cookie
                                                    var accessTokenV2 = response.payload.accessToken;

                                                    setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                                                    // // Xóa cookie cũ (refreshToken)
                                                    // deleteCookie("refreshToken");

                                                    // Gửi lại yêu cầu gốc với accessToken mới
                                                    sendSearchRequest(searchKeywords);
                                                },
                                                error: function (refreshError) {
                                                    if (refreshError.status === 403) {
                                                        // Trường hợp lỗi 403: Forbidden
                                                        // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                                                        // )
                                                        window.location.href = "http://localhost:8081/logout" +
                                                            "";
                                                    } else {
                                                        alert("Refresh token failed: " + refreshError);
                                                        // Xử lý lỗi khác khi refreshToken không thành công
                                                        window.location.href = "http://localhost:8081/logout" +
                                                            "";

                                                    }
                                                }
                                            });
                                        } else {
                                            alert("Error: " + error.status);
                                            // Xử lý lỗi khác (không phải lỗi 401)
                                            // window.location.href = "http://localhost:8081/logout
                                            // ";
                                        }
                                }
                            });
                            // setTimeout(()=>{location.reload();},200);
                        } else {
                            showError("Please fill in all required fields");
                        }
                    });
            }else {
                    alert("Must add Training Content first");
                    var day = selectedDay;
                    var unitNamefield1 = $('.uday--'+day);
                    var addDiv = $('<button>').addClass('add');
                    unitNamefield1.append(addDiv);
                }
            }
           else {
               alert("Must add UnitName first");
                var day = selectedDay;
                var unitNamefield1 = $('.uday--'+day);
                var addDiv = $('<button>').addClass('add');
                unitNamefield1.append(addDiv);
            }
    }
    function createdivTrainingFormat(format1){
        var trimmedFormat = format1.toString().trim();
        switch (trimmedFormat) {
            case 'ONLINE':
                return $('<div>').addClass('online').append($('<div>', {
                    class: 'online2',
                    text: trimmedFormat
                }));
                break;
            case 'OFFLINE':
                return $('<div>').addClass('offline').append(
                    $('<div>', {
                        class: 'offline2',
                        text: trimmedFormat
                    }));
                break;
        }
    }
    function createIconfordeliverType(deliverType){
        let svg = null;
        var type = deliverType.toString().trim()
        switch (type){
            case 'Assignment_Lab':
                svg = $('<svg class="assignment-lab" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12228)"><path d="M18 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V4C20 2.9 19.1 2 18 2ZM9 4H11V9L10 8.25L9 9V4ZM18 20H6V4H7V13L10 10.75L13 13V4H18V20Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12228"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>');
                break;
            case 'Concept_Lecture':
                svg = $('<svg class="assignment-lab" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12232)"><path d="M9 13C11.21 13 13 11.21 13 9C13 6.79 11.21 5 9 5C6.79 5 5 6.79 5 9C5 11.21 6.79 13 9 13ZM9 7C10.1 7 11 7.9 11 9C11 10.1 10.1 11 9 11C7.9 11 7 10.1 7 9C7 7.9 7.9 7 9 7ZM9 15C6.33 15 1 16.34 1 19V21H17V19C17 16.34 11.67 15 9 15ZM3 19C3.22 18.28 6.31 17 9 17C11.7 17 14.8 18.29 15 19H3ZM15.08 7.05C15.92 8.23 15.92 9.76 15.08 10.94L16.76 12.63C18.78 10.61 18.78 7.56 16.76 5.36L15.08 7.05ZM20.07 2L18.44 3.63C21.21 6.65 21.21 11.19 18.44 14.37L20.07 16C23.97 12.11 23.98 6.05 20.07 2Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12232"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>');
                break;
            case 'Guide_Review':
                svg = $('<svg class="assignment-lab" width="23" height="23" viewBox="0 0 23 23" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12236)"><path d="M17.25 23H10.9729C9.93794 23 8.9221 22.5687 8.20335 21.8212L1.20752 14.5283L3.19127 12.7746C3.78544 12.2475 4.65752 12.1421 5.3571 12.5158L7.66669 13.7425V4.59042C7.66669 3.26792 8.74002 2.19458 10.0625 2.19458C10.2254 2.19458 10.3884 2.21375 10.5513 2.2425C10.6375 0.996666 11.6725 0.00958252 12.9375 0.00958252C13.7617 0.00958252 14.4804 0.421666 14.9117 1.05417C15.1896 0.939166 15.4963 0.881666 15.8125 0.881666C17.135 0.881666 18.2084 1.955 18.2084 3.2775V3.54583C18.3617 3.51708 18.5246 3.49792 18.6875 3.49792C20.01 3.49792 21.0834 4.57125 21.0834 5.89375V19.1667C21.0834 21.2846 19.3679 23 17.25 23ZM3.96752 14.6433L9.58335 20.4892C9.94752 20.8629 10.4459 21.0833 10.9634 21.0833H17.25C18.3042 21.0833 19.1667 20.2208 19.1667 19.1667V5.89375C19.1667 5.62542 18.9559 5.41458 18.6875 5.41458C18.4192 5.41458 18.2084 5.62542 18.2084 5.89375V11.5H16.2917V3.2775C16.2917 3.00917 16.0809 2.79833 15.8125 2.79833C15.5442 2.79833 15.3334 3.00917 15.3334 3.2775V11.5H13.4167V2.40542C13.4167 2.13708 13.2059 1.92625 12.9375 1.92625C12.6692 1.92625 12.4584 2.13708 12.4584 2.40542V11.5H10.5417V4.59042C10.5417 4.32208 10.3309 4.11125 10.0625 4.11125C9.79419 4.11125 9.58335 4.33167 9.58335 4.59042V16.9242L4.45627 14.2121L3.96752 14.6433Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12236"><rect width="23" height="23" fill="white"/></clipPath></defs></svg>');
                break;
            case 'Test_Quiz':
                svg = $('<svg class="assignment-lab" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12240)"><path d="M18 2H2C0.9 2 0 2.9 0 4V18C0 19.1 0.9 20 2 20H18C19.1 20 20 19.1 20 18V4C20 2.9 19.1 2 18 2ZM18 18H2V4H18V18Z" fill="#285D9A"/><path d="M17.41 7.42L15.99 6L12.82 9.17L11.41 7.75L10 9.16L12.82 12L17.41 7.42Z" fill="#285D9A"/><path d="M8 8H3V10H8V8Z" fill="#285D9A"/><path d="M8 12H3V14H8V12Z" fill="#285D9A"/><path d="M8 16H3V18H8V16Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12240"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>');
                break;
            case 'Exam':
                svg = $('<svg class="assignment-lab" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12244)"><path d="M12.45 16H14.54L9.42996 3H7.56996L2.45996 16H4.54996L5.66996 13H11.31L12.45 16ZM6.42996 11L8.49996 5.48L10.57 11H6.42996ZM21.59 11.59L13.5 19.68L9.82996 16L8.41996 17.41L13.51 22.5L23 13L21.59 11.59Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12244"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>');
                break;
            case 'Seminar_Workshop':
                svg = $('<svg class="assignment-lab" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_750_12248)"><path d="M12 5C8.13 5 5 8.13 5 12H7C7 9.24 9.24 7 12 7C14.76 7 17 9.24 17 12H19C19 8.13 15.87 5 12 5ZM13 14.29C13.88 13.9 14.5 13.03 14.5 12C14.5 10.62 13.38 9.5 12 9.5C10.62 9.5 9.5 10.62 9.5 12C9.5 13.02 10.12 13.9 11 14.29V17.59L7.59 21L9 22.41L12 19.41L15 22.41L16.41 21L13 17.59V14.29ZM12 1C5.93 1 1 5.93 1 12H3C3 7.03 7.03 3 12 3C16.97 3 21 7.03 21 12H23C23 5.93 18.07 1 12 1Z" fill="#285D9A"/></g><defs><clipPath id="clip0_750_12248"><rect width="24" height="24" fill="white"/></clipPath></defs></svg>');
                break;
        }
        return svg ;
    }
    function getDeliveryAndType(unitCode) {
        var urlDelivery = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/showDeliverType';
        var urlType = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/showType';
        var topicCode = topicCodedata;
        var day = selectedDay;
        var urlTrainingUnit = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/ShowTrainingUnit/' + topicCode + '/' + day;
        // Create promises for both AJAX requests
        var accessToken = getCookie("accessToken");
        var promiseDelivery = $.ajax({
            url: urlDelivery,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
        });

        var promiseType = $.ajax({
            url: urlType,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
        });

        var promiseTrainingUnit = $.ajax({
            url: urlTrainingUnit,
            type: 'GET',
            headers: {
                "Authorization": "Bearer " + accessToken // Sử dụng Bearer token nếu cần
            },
            xhrFields: {
                withCredentials: true
            },
        });
        // Use Promise.all to wait for both promises to resolve
        Promise.all([promiseDelivery, promiseType, promiseTrainingUnit])
            .then(function (results) {
                // results[0] will have the data from the first AJAX request (delivery type)
                // results[1] will have the data from the second AJAX request (type)

                var deliveryData = results[0];
                var typeData = results[1];
                var trainingUnit = results[2];
                // Call addTrainingContent with both sets of data
                addTrainingContentform(deliveryData, typeData,trainingUnit,unitCode);
            })
            .catch(function (error) {
            // alert(error);
            // Xử lý lỗi khi gửi yêu cầu
            if (error.status === 401) {
                // Trường hợp lỗi 401: Unauthorized
                // Gửi yêu cầu refreshToken để lấy accessToken mới
                var refreshToken = getCookie("refreshToken");
                $.ajax({
                    url: "http://localhost:8080/api/v1/auth/refreshToken",
                    method: "POST",
                    data: JSON.stringify({ refreshToken: refreshToken }), // Đặt refreshToken vào phần thân của yêu cầu
                    contentType: "application/json", // Xác định kiểu dữ liệu của yêu cầu
                    xhrFields: {
                        withCredentials: true
                    },
                    success: function (response) {
                        //Xóa cookie cũ (accessToken)
                        deleteCookie("accessToken");
                        // Lưu accessToken mới vào cookie
                        var accessTokenV2 = response.payload.accessToken;

                        setCookie("accessToken",accessTokenV2 , 1); // Ví dụ: thời gian sống 1 giờ

                        // // Xóa cookie cũ (refreshToken)
                        // deleteCookie("refreshToken");

                        // Gửi lại yêu cầu gốc với accessToken mới
                        sendSearchRequest(searchKeywords);
                    },
                    error: function (refreshError) {
                        if (refreshError.status === 403) {
                            // Trường hợp lỗi 403: Forbidden
                            // Chuyển hướng trình duyệt đến trang khác (ví dụ: http://localhost:8081/logout
                            // )
                            window.location.href = "http://localhost:8081/logout" +
                                "";
                        } else {
                            alert("Refresh token failed: " + refreshError);
                            // Xử lý lỗi khác khi refreshToken không thành công
                            window.location.href = "http://localhost:8081/logout" +
                                "";

                        }
                    }
                });
            } else {
                alert("Error: " + error.status);
                // Xử lý lỗi khác (không phải lỗi 401)
                // window.location.href = "http://localhost:8081/logout
                // ";
            }
            });
    }

    // Warning
    function showWarning(message){
        var warningToast = document.querySelector('.toast.warning');
        var loadingBar1 = warningToast.querySelector('.loadingWarning');
        warningToast.style.opacity = '1';
        warningToast.style.pointerEvents = 'auto'; // Enable pointer events
        loadingBar1.classList.add('active');
        var warningText = warningToast.querySelector('.container-2Text p:last-child');

        warningText.textContent = message;
        setTimeout(function () {
            loadingBar1.classList.remove('active');
            warningToast.style.opacity = '0';
            warningToast.style.pointerEvents = 'none'; // Disable pointer events when hidden
        }, 2500);
    }
    //===============================================================

    // Error
    function showError(message) {
        var errorToast = document.querySelector('.toast.error');
        var loadingBar1 = errorToast.querySelector('.loading1');
        var errorText = errorToast.querySelector('.container-2Text p:last-child');

        errorText.textContent = message;

        errorToast.style.opacity = '1';
        errorToast.style.pointerEvents = 'none'; // Disable pointer events when hidden
        loadingBar1.classList.add('active');

        setTimeout(function () {
            loadingBar1.classList.remove('active');
            errorToast.style.opacity = '0';
            errorToast.style.pointerEvents = 'none'; // Disable pointer events when hidden
        }, 2500);
    }
    // ==================================================================

    // Success
    function showSuccess(message){
        var successToast = document.querySelector('.toast.success');
        var loadingBar1 = successToast.querySelector('.loadingSucces');
        successToast.style.opacity = '1';
        successToast.style.pointerEvents = 'none'; // Disable pointer events when hidden
        loadingBar1.classList.add('active');
        var successText = successToast.querySelector('.container-2Text p:last-child');

        successText.textContent = message;
        setTimeout(function () {
            loadingBar1.classList.remove('active');
            successToast.style.opacity = '0';
            successToast.style.pointerEvents = 'none'; // Disable pointer events when hidden
        }, 2500);
    }
    //=============================================================
    function loadChart() {
    var topicCode = localStorage.getItem('topicCode');
    if(topicCode != null){
        $.ajax({
            url: 'http://localhost:8080/api/v1/syllabus/getGeneralScreen/' + topicCode
            ,type: 'GET',
            success: function (rs) {
                console.log(rs);
                $('#topicCode').html(rs.topicCode);
                $('#version').html(rs.version);
                console.log(rs.level);
                console.log(rs.assignment);

                document.getElementById('assignment_pie').innerHTML = "(" + rs.assignment +"%" + ")";
                document.getElementById('quiz_pie').innerHTML = "(" + rs.quiz +"%" + ")";
                document.getElementById('final_test_pie').innerHTML = "(" + rs.finalTest +"%" + ")";
                document.getElementById('final_theory_pie').innerHTML = "(" + rs.finalTheory +"%" + ")";
                document.getElementById('final_practice_pie').innerHTML = "(" + rs.finalPractice +"%" + ")";

                const assignment = rs.assignment;
                const quiz = rs.quiz;
                const final = rs.finalTest;
                const final_theory = rs.finalTheory;
                const final_practice = rs.finalPractice;

                // Get the canvas element
                var ctx = document.getElementById('doughnut').getContext('2d');

                var doughnut = new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['Assignment', 'Quiz', 'Final', 'Final Theory', 'Final Practice'],
                        datasets: [{
                            data: [assignment, quiz, final, final_theory, final_practice], // Replace with your own data values
                            backgroundColor: ['#f4be37', '#ff9f40', '#0d2535', '#5388d8', '#206ee5'] // Replace with desired colors
                        }]
                    },options: {
                        plugins: {
                            legend: {
                                display: false,
                            }
                        },
                        maintainAspectRatio: true,
                    },
                    animation: {
                        animateRotate: true, // Animate rotation of the pie chart
                        animateScale: true // Animate scaling of the pie chart
                    }
                });

            },error(){


            }

        });
    }else{

        document.getElementById('assignment_pie').innerHTML = "(" + "0" +"%" + ")";
        document.getElementById('quiz_pie').innerHTML = "(" + "0" +"%" + ")";
        document.getElementById('final_test_pie').innerHTML = "(" + "0" +"%" + ")";
        document.getElementById('final_theory_pie').innerHTML = "(" + "0" +"%" + ")";
        document.getElementById('final_practice_pie').innerHTML = "(" + "0" +"%" + ")";

        var ctx = document.getElementById('doughnut').getContext('2d');

        const doughnut = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Empty'],
                datasets: [{
                    data: [100],
                    backgroundColor: ['black']
                }]
            },
            options: {
                // Add any desired options here
            }
        });
    }

    }
    //===============================================================
    function getCookie(name) {
        var cookieArray = document.cookie.split("; ");
        for (var i = 0; i < cookieArray.length; i++) {
            var cookie = cookieArray[i].split("=");
            if (cookie[0] === name) {
                return cookie[1];
            }
        }
        return null;
    }
    //===============================================================
    function setCookie(name, value, hours) {
        var date = new Date();
        date.setTime(date.getTime() + (hours * 60 * 60 * 1000)); // Thời gian sống tính bằng mili giây

        var expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
    }
    //===============================================================
</script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

</body>

</html>