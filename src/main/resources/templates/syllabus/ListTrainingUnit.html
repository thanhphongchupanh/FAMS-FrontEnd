<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/css/Bootstrap%205/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <script src="/js/Bootstrap%205/bootstrap.bundle.min.js"></script>
    <script src="/js/JQuery/jquery-3.7.1.js"></script>
    <link href="/css/select2/select2.css" rel="stylesheet" />
    <script src="/js/select2/select2.min.js"></script>
    <link href="/css/DataTable/jquery.dataTables.css" rel="stylesheet">
    <script src="/js/DataTable/jquery.dataTables.js"></script>
    <link href="/css/user.css" rel="stylesheet" >
    <!--    <script src="/js/user.js"></script>-->
    <link rel="shortcut icon" type="image/png" href="img/FPT_logo.png"/>
    <link href='https://fonts.googleapis.com/css?family=Inter' rel='stylesheet'>
    <link rel="stylesheet" href="css/syllabus/createSyllabusOutline.css">

    <title>Document</title>
</head>
<body>
<header class="bg-main text-white px-5 py-1" >
    <div th:replace="~{common :: header}"></div>
</header>

<div class="d-flex flex-grow-1 flex-row">
    <div th:replace="~{common :: menu}"></div>

    <div class="frame-1186">
        <div class="program-detail">
            <div class="program-header">
                <div class="frame-1191">
                    <div class="training-program">Syllabus</div>
                    <!-- props: {"phase":{"type":"VARIANT","defaultValue":"'general'","variantOptions":["General","Outline","Done","Other"]}} -->
                    <div class="progress-bar">
                        <div class="label">
                            <div class="bar">
                                <div class="progress-bar2"></div>
                            </div>
                            <div class="padding">
                                <div class="text">General</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar2">
                                <div class="progress-bar2">
                                    <div class="ellipse-offset-to-get-to-the-middle">
                                        <div class="ellipse"></div>
                                    </div>
                                </div>
                                <div class="spacer"></div>
                            </div>
                            <div class="padding">
                                <div class="text">Outline</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar2">
                                <div class="progress-bar1"></div>
                            </div>
                            <div class="padding">
                                <div class="text2">Other</div>
                            </div>
                        </div>
                        <div class="label">
                            <div class="bar3">
                                <div class="progress-bar1"></div>
                            </div>
                            <div class="padding">
                                <div class="text">Done</div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="basic-info">
                <div class="syllabus-name-code">
                    <div class="req-text-box">
                        <div class="text3">Syllabus Name*</div>
                        <input type="text" id="syllabusNameInput" name="" value="" class="text-box">
                    </div>
                    <div class="req-text-box">
                        <div class="text3">Code:</div>
                        <div class="npl">NPL</div>
<!--                        <input type="hidden" id="syllabusCode" name="" value="" class="text-box" >-->
                    </div>
                    <div class="req-text-box">
                        <div class="text3">Version:</div>
                        <div class="_1-0">1.0</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="frame-1189">
            <div class="b-ody">
                <div class="syllabus-tab">
                    <div class="tab-3">
                        <div class="frame-51">
                            <div class="tab-2">Others</div>
                        </div>
                    </div>
                    <div class="tab-1">
                        <div class="frame-51">
                            <div class="general">General</div>
                        </div>
                    </div>
                    <div class="tab-22">
                        <div class="frame-51">
                            <div class="tab-2">Outline</div>
                        </div>
                    </div>
                </div>
                <div class="frame-1207">
                    <div class="frame-1192">
                        <div class="content">
                            <div class="day-3">
                                <div class="frame-1193"></div>
<!--                                <div class="frame-54"></div>-->
                                <div class="add-unit-button">
                                    <div class="add-day-button2">
                                        <svg
                                                class="add3"
                                                width="24"
                                                height="24"
                                                viewBox="0 0 24 24"
                                                fill="none"
                                                xmlns="http://www.w3.org/2000/svg"
                                        >
                                            <g clip-path="url(#clip0_1173_19892)">
                                                <path
                                                        d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z"
                                                        fill="#F1F1F1"
                                                />
                                            </g>
                                            <defs>
                                                <clipPath id="clip0_1173_19892">
                                                    <rect width="24" height="24" fill="white" />
                                                </clipPath>
                                            </defs>
                                        </svg>

                                        <button class="add-unit">Add unit</button>
                                    </div>
                                </div>

                            </div>
                            <button class="add-day-button-2">
                                <div class="add-day-button3">
                                    <svg
                                            class="add3"
                                            width="24"
                                            height="24"
                                            viewBox="0 0 24 24"
                                            fill="none"
                                            xmlns="http://www.w3.org/2000/svg"
                                    >
                                        <g clip-path="url(#clip0_1173_19917)">
                                            <path
                                                    d="M13 7H11V11H7V13H11V17H13V13H17V11H13V7ZM12 2C6.49 2 2 6.49 2 12C2 17.51 6.49 22 12 22C17.51 22 22 17.51 22 12C22 6.49 17.51 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z"
                                                    fill="#F1F1F1"
                                            />
                                        </g>
                                        <defs>
                                            <clipPath id="clip0_1173_19917">
                                                <rect width="24" height="24" fill="white" />
                                            </clipPath>
                                        </defs>
                                    </svg>

                                    <div class="add-day">Add day</div>
                                </div>
                            </button>
                            <div class="rectangle-2487"></div>
                        </div>
                        <div class="rectangle-645"></div>
                    </div>
                </div>
            </div>
            <div class="frame-1190">
                <div class="time-allocation">
                    <div class="time-allocation2">Time allocation</div>
                </div>
                <div class="time-allocation3">
                    <div class="time-allocation2">Time allocation</div>
                </div>
                <div class="content2">
                    <div class="doughnut">
                        <div class="_01"></div>
                        <div class="_02"></div>
                        <div class="_03"></div>
                        <div class="_04"></div>
                    </div>
                    <div class="info">
                        <div class="frame-1082">
                            <div class="bullet">
                                <div class="rectangle-644"></div>
                            </div>
                            <div class="assignment-lab">Assignment/Lab</div>
                            <div class="_54">(54%)</div>
                        </div>
                        <div class="frame-109">
                            <div class="bullet">
                                <div class="rectangle-6442"></div>
                            </div>
                            <div class="concept-lecture5">Concept/Lecture</div>
                            <div class="_29">(29%)</div>
                        </div>
                        <div class="frame-110">
                            <div class="bullet">
                                <div class="rectangle-6443"></div>
                            </div>
                            <div class="guide-review2">Guide/Review</div>
                            <div class="_9">(9%)</div>
                        </div>
                        <div class="frame-1112">
                            <div class="bullet">
                                <div class="rectangle-6444"></div>
                            </div>
                            <div class="test-quiz">Test/Quiz</div>
                            <div class="_1">(1%)</div>
                        </div>
                        <div class="frame-112">
                            <div class="bullet">
                                <div class="rectangle-6445"></div>
                            </div>
                            <div class="exam">Exam</div>
                            <div class="_6">(6%)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="saving-button">
            <div class="frame-92">
                <div class="previous">Previous</div>
            </div>
            <div class="frame-1201">
                <div class="add-day-button4">
                    <div class="cancel">Cancel</div>
                </div>
                <div class="frame-91">
                    <div class="save">Save as draft</div>
                </div>
                <div class="frame-912">
                    <a th:href="@{/createSyllabusOtherScreen}" style="text-decoration: none; color: #eeecec">
                        <div class="next save-btn">
                            Next
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>


</div>

<div th:replace="~{common :: footer}"></div>

<script src="/js/common.js"></script>

<script>
    var topicCodedata;
    var api2;
    var selectedDay;
    var unitCodedata;
    var apiUrl2;

    $(document).ready(function() {
        // Event listener for the input field
        $('#syllabusNameInput').on('input', function() {
            var syllabusName = $(this).val();
            localStorage.setItem('syllabusName', syllabusName);
             loadData(syllabusName);
        });

        // Load data when the page is refreshed
        var savedSyllabusName = localStorage.getItem('syllabusName');

        if (savedSyllabusName) {
            $('#syllabusNameInput').val(savedSyllabusName);
            loadData(savedSyllabusName);
        }

        // Event listener for adding a day
        $('.add-day-button-2').click(function() {
           addDay();
        });

        // Event listener for adding a TrainingUnit

        // $('.add-unit').click(function() {
        //     alert('add unit nè :)))');
        //     addUnitCode();
        //     // updateUnitNames(data);
        // });

    });
    function updateUnitNames(data) {
        var unitNames = data.unitName;
        var unitCodes = data.unitCode;
        console.log(unitCodes);
        const lastestUnitCode = unitCodes[unitCodes.length - 1];
        unitCodedata = lastestUnitCode;
        // var unitNamefield = $('.frame-54');
        // unitNamefield.empty();

        $.each(unitNames, function (index, unitName) {
            var unitNamefield = $('<div>',{
                class : 'frame-54'
            });
            var unitContainer = $('<div>', {
                class: 'frame-108'
            });
            var unitLabel = $('<div>', {
                class: 'unit-7',
                text: 'Unit ' + (index + 1) // You may need to adjust the index accordingly
            });

            var programContainer = $('<div>', {
                class: 'frame-1199'
            });
            var programName = $('<div>', {
                class: 'program-name'
            });
            var unitNameElement = $('<div>', {
                class: 'unit-name',
                text:'Unit Name'
            });
            var frame84 = $('<div>', {
                class: 'frame-84'
            });
            var typeUnitName = $('<input>', {
                class: 'type-unit-name styled-input',
                type: 'text',
                id: 'unitNameInput',
                placeholder: 'Type unit name',
                value: unitName
            });
            var transferunitCode = $('<input>', {
                type: 'text',
                // id:'unitCode',
                class: 'unitCodee',
                value: unitCodes[index]
            });
            var frame66 = $('<div>', {
                class: 'frame-66'
            });
            var create = $('<button>', {
                class: 'create',
                text: 'Create'
            });

            // Assemble the structure
            frame66.append(create);
            frame84.append(typeUnitName);
            frame84.append(transferunitCode);
            frame84.append(frame66);
            programName.append(unitNameElement);
            programName.append(frame84);
            programContainer.append(programName);
            unitContainer.append(unitLabel);
            // unitContainer.append(programContainer);
            unitNamefield.append(unitContainer);
            unitNamefield.append(programContainer);
            $('.frame-1193').append(unitNamefield);

            // unitNamefield.append(addbtnAddunit());
            typeUnitName.on('change', function () {
                var typedUnitName = $(this).val();
                create.click(function () {
                    createUnitName(data,typedUnitName);
                    addUnitCode();
                    loadTrainingUnit(data);
                });
            });

                function createUnitName(data, typedUnitName){
                    // var unitName = $("#unitNameInput").val();
                    var unitName = typedUnitName;
                    var topicCode = topicCodedata;
                    var dayNumber = selectedDay;
                    var unitCodes1 = data.unitCode;
                    console.log(unitName);
                    const lastestUnitCode = unitCodes1[unitCodes1.length - 1];
                    unitCodedata = lastestUnitCode;

                    console.log("hôm nay tôi ngu: "+selectedDay);
                    // alert('Clicked on Day: ' + $(this).text());
                    // Second AJAX request to load unit names for the selected day
                    var apiUrl = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/createTrainingUnit/' + topicCode + '/' + dayNumber + '/' + lastestUnitCode;
                    $.ajax({
                        url: apiUrl,
                        type: 'POST',
                        contentType: 'application/json', // Set the content type if needed
                        data: JSON.stringify({ unitName: unitName }), // Send the unitName as JSON data
                        success: function (data) {
                            // Handle the API response here
                            console.log('API response:', data);
                            // console.log(unitCode);
                            // You can perform additional actions as needed
                        },
                        error: function (error) {
                            // Handle any errors here
                            console.error('API error:', error);
                        }
                    });
                }
            })

    }
    // Define a function to load data based on the syllabus name
    function loadData(syllabusName) {
        var apiUrl = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/' + syllabusName;
        // First AJAX request to load syllabus data
        $.ajax({
            url: apiUrl,
            type: 'GET',
            success: function (data) {
                console.log(data);
                // Handle the successful response and update the HTML elements
                updateSyllabusData(data);
                api2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/' + data.topicCode + '/';
            },
            error: function (error) {
                console.log('Error:', error);
            }
        });


    }
    function addUnitCode(){
        var topicCode1 = topicCodedata;
        var dayNumber1 = selectedDay;
        var apiUrl1 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/addTrainingUnitCode/'+ topicCode1 + '/' + dayNumber1;

        $.ajax(
            {
                url : apiUrl1,
                type : 'POST',

                success: function(response) {
                    // Handle the successful response or any additional actions
                    console.log(response);

                    // Reload the page after a successful request
                    location.reload();
                },
                error: function(error) {
                    // Handle the error or any error-specific actions
                    console.log('Error:', error);
                }
            }
        )
    }
    function  addDay(){
        if (topicCodedata) {
            var syllabusCode = topicCodedata;
            var apiUrl2 = "http://localhost:8080/api/v1/syllabus/OutlineScreen/addDay/" + syllabusCode;
            $.ajax({
                url: apiUrl2,
                type: 'POST',
                success: function(response) {
                    // Handle the successful response or any additional actions
                    console.log(response);

                    // Reload the page after a successful request
                    location.reload();
                },
                error: function(error) {
                    // Handle the error or any error-specific actions
                    console.log('Error:', error);
                }
            });
        }
    }
    function updateSyllabusData(data) {
        topicCodedata = data.topicCode;
        var versiondata = data.version;
        var days = data.dayNumber; // Assuming this is an array of days

        // Create an array to keep track of added days
        var addedDays = [];

        // Update the day labels and other elements based on data
        var dayContainer = $('.frame-1193');
        dayContainer.empty();

        for (var i = 0; i < days.length; i++) {
            var day = days[i];

            // Check if the day has already been added
            if (!addedDays.includes(day)) {
                addedDays.push(day); // Add the day to the list of added days

                var dayfield = $('<button>').addClass('day').text('Day ' + day);
                var clickableIcon = createClickableRemoveIcon(); // Create the clickable icon
                dayfield.append(clickableIcon);

                var addclass1 = $('<button>').addClass('frame-48');
                var addclass2 = $('<div>').addClass('frame-512');
                var addclass3 = $('<div>').addClass('frame-513');

                addclass3.append(dayfield);
                addclass2.append(addclass3);
                addclass1.append(addclass2);

                dayContainer.append(addclass1);

                // Attach the click event to the newly created day buttons
                dayfield.click(function () {
                    selectedDay = $(this).text().replace('Day ', '');

                    // Update the API URL for the second request with the selected day
                    var updatedApi2 = api2 + selectedDay;
                    apiUrl2 = 'http://localhost:8080/api/v1/syllabus/OutlineScreen/' + data.topicCode + '/' + selectedDay ;
                    console.log("hôm nay tôi ngu: " + selectedDay);
                    alert('Clicked on Day: ' + $(this).text());
                    // Second AJAX request to load unit names for the selected day
                    $.ajax({
                        url: updatedApi2,
                        type: 'GET',
                        success: function (data) {
                            // Handle the successful response and update the HTML elements
                            updateUnitNames(data);
                            loadTrainingUnit(data)
                            // createTrainingUnit(data);
                        },
                        error: function (error) {
                            console.log('Error:', error);
                        }
                    });
                });
            }
        }

        var topicCodefield = $('.npl');
        var versionfield = $('._1-0');

        topicCodefield.empty().text(topicCodedata);
        versionfield.empty().text(versiondata);
    }
    // Function to update the unit names
    function createClickableRemoveIcon() {
        var svgElement = $('<svg>', {
            class: 'remove-circle-outline',
            width: '24',
            height: '24',
            viewBox: '0 0 24 24',
            fill: 'none',
            'xmlns:xlink': 'http://www.w3.org/2000/svg',
        });

        var clipPathElement = $('<clipPath>', {
            id: 'clip0_1173_20029',
        }).append($('<rect>', {
            width: '24',
            height: '24',
            fill: 'white',
        }));

        var pathElement = $('<path>', {
            d: 'M7 11V13H17V11H7ZM12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z',
            fill: '#E74A3B',
        });

        svgElement.append(clipPathElement);
        svgElement.append(pathElement);

        // Add a click event listener to the icon
        svgElement.click(function() {
            // Handle the click event here
            // You can access information related to the clicked "Day" div
            // You can use $(this) to refer to the clicked icon
        });

        return svgElement;
    }
    function loadTrainingUnit(data) {
        var unitNames1 = data.unitName;
        var unitCodes1 = data.unitCode;
        // var duration = data.
        alert(unitNames1);
        console.log(unitCodes1);
        // const lastestUnitCode1 = unitCodes1[unitCodes1.length - 1];
        // unitCodedata = lastestUnitCode;
        var unitNamefield = $('.frame-54');
        unitNamefield.empty();

        $.each(unitNames1, function (index, unitName1) {
            var unitNamefield = $('<div>', {
                class: 'frame-54'
            });
            var unitContainer = $('<div>', {
                class: 'frame-108'
            });
            var unitLabel = $('<div>', {
                class: 'unit-7',
                text: 'Unit ' + (index + 1)
            });

            var programContainer = $('<div>', {
                class: 'frame-1199'
            });
            var programName = $('<div>', {
                class: 'program-name'
            });
            var unitNameElement = $('<div>', {
                class: 'unit-7',
                text: unitName1 // Display the unit name
            });
            // var transferunitCode = $('<input>', {
            //     type: 'hidden',
            //     // id:'unitCode',
            //     class: 'unitCodee',
            //     value: unitCodes[index]
            // });

            // Assemble the structure
            programName.append(unitNameElement);
            programContainer.append(programName);
            unitContainer.append(unitLabel);
            unitNamefield.append(unitContainer);
            unitNamefield.append(programContainer);
            $('.frame-1193').append(unitNamefield);
        });
        $('.add-unit').click(function() {
            alert('add unit nè :)))');
            updateUnitNames(data);

        });

        // var apiUrl3 = apiUrl2 + transferunitCode;

            // alert(apiUrl3);
    }
</script>

<script>
    // Hàm để lấy giá trị từ query parameter
    document.addEventListener('DOMContentLoaded', function() {
    function getQueryParam(parameter) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(parameter);
    }

    const param1Value = getQueryParam('param1');
    if (param1Value) {
        document.getElementById('syllabusNameInput').value = param1Value;
        console.log(param1Value);
    } else {
        console.log('Không có giá trị param1 được truyền.');
    }
    });
</script>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</body>

</html>